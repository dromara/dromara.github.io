<!doctype html><html><head><title>SOFABoot 3.0 升级注意事项 · SOFAStack</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="SOFAStack is a Scalable Open Financial Architecture for building cloud native applications"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=https://gw.alipayobjects.com/os/q/cms/images/jqu9346l/4ba95631-2489-4885-881f-bc7f8d787d5e_w64_h61.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="zh"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-142131411-1','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=请输入要搜索的关键词><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/projects/><span>项目</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/guides/><span>指南</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/blog/><span>博客</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/activities/><span>活动</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/community/><span>社区</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome SOFA</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/projects/sofa-boot/upgrade_3_x/><span>English</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/projects/>项目</a>
<a class=navbar-item href=/guides/>指南</a>
<a class=navbar-item href=/blog/>博客</a>
<a class=navbar-item href=/activities/>活动</a>
<a class=navbar-item href=/community/>社区</a>
<a class=navbar-item href=/awesome/>Awesome SOFA</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=请输入要搜索的关键词><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/en/projects/sofa-boot/upgrade_3_x/>En</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"><div id=js-drawer class=ss-toc><div id=js-drawer-handle class=drawer-handle><svg class="icon icon-menu" aria-hidden="true"><use xlink:href="#icon-menu"/></svg><svg class="icon icon-close" aria-hidden="true"><use xlink:href="#icon-close"/></svg></div><div class=drawer-body><div class=header title="SOFABoot 基于 Spring Boot 的研发框架，在其基础上提供了诸如 Readiness Check，类隔离，日志空间隔离，Bean 异步初始化等能力。">SOFABoot<div class="ss-toc-list-card -hidden-mobile"><svg class="icon -hidden-mobile" aria-hidden="true"><use xlink:href="#icon-menu1"/></svg><div class=ss-tooltip><div class=toc-list><h4 class=title>主要项目</h4><ul class=list><li class=item><a href=/projects/sofa-boot/overview>SOFABoot</a></li><li class=item><a href=/projects/sofa-rpc/overview>SOFARPC</a></li><li class=item><a href=/projects/sofa-tracer/overview>SOFATracer</a></li><li class=item><a href=/projects/sofa-lookout/overview>SOFALookout</a></li><li class=item><a href=/projects/sofa-registry/overview>SOFARegistry</a></li></ul></div><div class=toc-list><h4 class=title>孵化项目</h4><ul class=list><li class=item><a href=/projects/sofa-mesh/overview>SOFAMesh</a></li><li class=item><a href=/projects/sofa-dashboard/overview>SOFADashboard</a></li></ul></div><div class=toc-list><h4 class=title>工具项目</h4><ul class=list><li class=item><a href=/projects/sofa-bolt/overview>SOFABolt</a></li><li class=item><a href=/projects/sofa-jraft/overview>SOFAJRaft</a></li><li class=item><a href=/projects/sofa-acts/overview>SOFAActs</a></li><li class=item><a href=https://www.sofastack.tech/projects/sofa-boot/sofa-ark-readme/>SOFAArk</a></li></ul></div><div class=toc-list><h4 class=title>生态项目</h4><ul class=list><li class=item><a href=https://mosn.io>MOSN</a></li><li class=item><a href=https://occlum.io>Occlum</a></li><li class=item><a href=https://seata.io>Seata</a></li></ul></div></div></div></div><div class=body><ul class=leaf-section><li class=item><div class=link><a title="SOFABoot 介绍" href=/projects/sofa-boot/overview>SOFABoot 介绍</a></div></li><li class=item><div class=link><a title=快速开始 href=/projects/sofa-boot/quick-start>快速开始</a></div></li><li class=item><div class=link><a title=依赖管理 href=/projects/sofa-boot/dependency-management>依赖管理</a></div></li><li class=item><div class=link><a title=健康检查 href=/projects/sofa-boot/health-check>健康检查</a></div></li><li class=item><div class=link><a title=版本查看 href=/projects/sofa-boot/view-versions>版本查看</a></div></li><li class=item><div class=link><a title=启动加速 href=/projects/sofa-boot/speed-up-startup>启动加速</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=模块隔离>模块隔离</a></div><ul class=leaf-section><li class=item><div class=link><a title=模块化开发概述 href=/projects/sofa-boot/modular-development>模块化开发概述</a></div></li><li class=item><div class=link><a title=模块配置 href=/projects/sofa-boot/sofaboot-module>模块配置</a></div></li><li class=item><div class=link><a title="JVM 服务发布与引用" href=/projects/sofa-boot/module-service>JVM 服务发布与引用</a></div></li><li class=item><div class=link><a title=模块并行化启动 href=/projects/sofa-boot/parallel-start>模块并行化启动</a></div></li><li class=item><div class=link><a title="Spring Bean 异步初始化" href=/projects/sofa-boot/bean-async-init>Spring Bean 异步初始化</a></div></li><li class=item><div class=link><a title="SOFABoot Profile" href=/projects/sofa-boot/sofaboot-profile>SOFABoot Profile</a></div></li><li class=item><div class=link><a title="SOFABoot 拓展点" href=/projects/sofa-boot/extension>SOFABoot 拓展点</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=类隔离>类隔离</a></div><ul class=leaf-section><li class=item><div class=link><a title="SOFAArk 介绍" href=/projects/sofa-boot/sofa-ark-readme>SOFAArk 介绍</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=快速开始>快速开始</a></div><ul class=leaf-section><li class=item><div class=link><a title="如何打包 Ark Plugin" href=/projects/sofa-boot/sofa-ark-ark-plugin-demo>如何打包 Ark Plugin</a></div></li><li class=item><div class=link><a title="如何打包 Ark 包" href=/projects/sofa-boot/sofa-ark-ark-demo>如何打包 Ark 包</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=用户文档>用户文档</a></div><ul class=leaf-section><li class=item><div class=link><a title=基础术语 href=/projects/sofa-boot/sofa-ark-terminology>基础术语</a></div></li><li class=item><div class=link><a title="Ark 包" href=/projects/sofa-boot/sofa-ark-ark-jar>Ark 包</a></div></li><li class=item><div class=link><a title="Ark Plugin" href=/projects/sofa-boot/sofa-ark-ark-plugin>Ark Plugin</a></div></li><li class=item><div class=link><a title="Ark Biz" href=/projects/sofa-boot/sofa-ark-ark-biz>Ark Biz</a></div></li><li class=item><div class=link><a title="SOFAArk 配置" href=/projects/sofa-boot/sofa-ark-ark-config>SOFAArk 配置</a></div></li><li class=item><div class=link><a title="Ark Biz 生命周期" href=/projects/sofa-boot/sofa-ark-biz-lifecycle>Ark Biz 生命周期</a></div></li><li class=item><div class=link><a title="Zookeeper 配置" href=/projects/sofa-boot/sofa-ark-zk-config>Zookeeper 配置</a></div></li><li class=item><div class=link><a title="Ark 服务机制" href=/projects/sofa-boot/sofa-ark-ark-service>Ark 服务机制</a></div></li><li class=item><div class=link><a title="Ark 事件机制" href=/projects/sofa-boot/sofa-ark-ark-event>Ark 事件机制</a></div></li><li class=item><div class=link><a title="Ark 扩展机制" href=/projects/sofa-boot/sofa-ark-ark-extension>Ark 扩展机制</a></div></li><li class=item><div class=link><a title="Ark 服务通信" href=/projects/sofa-boot/sofa-ark-ark-jvm>Ark 服务通信</a></div></li><li class=item><div class=link><a title="Telnet 指令" href=/projects/sofa-boot/sofa-ark-ark-telnet>Telnet 指令</a></div></li><li class=item><div class=link><a title="Ark 日志" href=/projects/sofa-boot/sofa-ark-ark-log>Ark 日志</a></div></li><li class=item><div class=link><a title="SOFABoot 使用类隔离" href=/projects/sofa-boot/classloader-isolation>SOFABoot 使用类隔离</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=开发文档>开发文档</a></div><ul class=leaf-section><li class=item><div class=link><a title="Ark 容器启动流程" href=/projects/sofa-boot/sofa-ark-startup>Ark 容器启动流程</a></div></li><li class=item><div class=link><a title="Ark 容器插件机制" href=/projects/sofa-boot/sofa-ark-plugin>Ark 容器插件机制</a></div></li><li class=item><div class=link><a title="Ark 容器类加载机制" href=/projects/sofa-boot/sofa-ark-classloader>Ark 容器类加载机制</a></div></li></ul></li><li class=item><div class=link><a title=发布说明 href=/projects/sofa-boot/sofa-ark-release>发布说明</a></div></li><li class=item><div class=link><a title=发展路线 href=/projects/sofa-boot/sofa-ark-roadmap>发展路线</a></div></li><li class=item><div class=link><a title=参与贡献 href=/projects/sofa-boot/sofa-ark-contribution>参与贡献</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=升级文档>升级文档</a></div><ul class=leaf-section><li class=item><div class=link><a title="SOFABoot 2.5.x 升级注意事项" href=/projects/sofa-boot/upgrade_2_5_x>SOFABoot 2.5.x 升级注意事项</a></div></li><li class=item><div class="link -current"><a title="SOFABoot 3.0 升级注意事项" href=/projects/sofa-boot/upgrade_3_x>SOFABoot 3.0 升级注意事项</a></div></li></ul></li><li class=item><div class=link><a title=常见问题 href=/projects/sofa-boot/faq>常见问题</a></div></li><li class=item><div class=link><a title=版权声明 href=/projects/sofa-boot/notice>版权声明</a></div></li></ul></div></div></div></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>SOFABoot 3.0 升级注意事项</h1><a class="edit-button -hidden-mobile" href=https://github.com/sofastack/sofastack.tech/edit/master/content/zh/projects/sofa-boot/upgrade_3_x/index.md>编辑</a></div><div class=meta>更新时间: 2021-01-20</div></div><article class=typo><h2 id=前言>前言</h2><p>SOFABoot 是蚂蚁金服开源的基于 Spring Boot 的研发框架，它在 Spring Boot 的基础上，提供了诸如 Readiness Check，类隔离，日志空间隔离等能力。在增强了 Spring Boot 的同时，SOFABoot 提供了让用户可以在 Spring Boot 中非常方便地使用 SOFA 中间件的能力。</p><p>自今年 4 月份 SOFABoot 开源至今，我们收到了非常多来自社区同学的反馈，也非常高兴的看到很多社区同学积极的参与到 SOFAStack 开源共建，这极大了鼓舞了我们建设 SOFAStack 开源社区的决心，力图把 SOFAStack 社区和生态建设更加繁荣。在此，我们宣布推出 SOFABoot 3.0 版本，SOFABoot 3.0 是基于 Spring Boot 2.0 版本开发。在 SOFABoot 3.0 中，可以将 SOFABoot 扩展能力和 Spring Boot 2.x 官方组件无缝集成。此外，我们在 SOFABoot 3.0 中兼容了 Spring Cloud 组件集成，可以很方便地在 SOFABoot 框架中集成 Spring Cloud 组件，如 Zuul, Config 等。</p><p>以下，本文将详细介绍 SOFABoot 3.0 相较 SOFABoot 2.x 的变更。</p><h2 id=spring-boot-升级-2-x>Spring Boot 升级 2.x</h2><p>SOFABoot 3.0 版本升级 Spring Boot 版本至 2.0。鉴于Spring Boot 社区最近刚公告 1.x 版本将维护至明年 8 月份为止，未来，我们也将主力维护 SOFABoot 3.x 版本，近期也将发布 SOFABoot 3.1 升级 Spring Boot 版本至 2.1。</p><h2 id=spring-cloud-兼容>Spring Cloud 兼容</h2><p>在 SOFABoot 2.x 中，存在部分组件和 SOFABoot 兼容性问题。在 SOFABoot 3.x 中，对 Spring Cloud 各组件进行了比较完备的兼容性测试和问题修复，保证了 SOFABoot 3.x 与 Spring Cloud 良好的兼容性。</p><h2 id=webflux-框架兼容>WebFlux 框架兼容</h2><p>Spring Boot 2.x 引入了 WebFlux 框架，SOFABoot 3.x 主要在两个方面兼容了 WebFlux 框架；
+ 健康检查兼容了 ReactiveHealthIndicator 扩展接口，业务对这个接口的扩展实现将会纳入到 Readiness Check；
+ 兼容对 WebFlux 网络请求进行埋点，埋点日志格式和文件保持对普通 MVC 请求兼容，详细参考<a href=https://www.sofastack.tech/sofa-tracer/docs/Usage_Of_MVC>MVC 埋点请求</a></p><h2 id=jdk-版本支持>JDK 版本支持</h2><p>SOFABoot 3.x 最低要求运行在 JDK 8 及其以上版本，不支持 JDK 6，7。</p><h2 id=健康检查>健康检查</h2><p>SOFABoot 为 Spring Boot 的健康检查能力增加了 Readiness Check 能力，以确保应用在正常对外服务前，所有组件及业务本身处于健康状态。相较于与 SOFABoot 2.x, SOFABoot 3.0 在健康检查做了很大的重构，主要是剥离了部分蚂蚁金服内部兼容逻辑，采用更加友好的编码方案；其次，SOFABoot 3.0 健康检查提供了多种不同场景下的健康检查扩展形式，支持 Spring Boot 2.x 引入的 <code>ReactiveHealthIndicator</code> 扩展接口，丰富了健康检查扩展特性。</p><h3 id=调整-readiness-check-endpoint-路径>调整 Readiness Check Endpoint 路径</h3><p>在 SOFABoot 2.x 中，查看健康检查结果的 Endpoint 为 <code>/health/readiness</code>，而在 SOFABoot 3.0 中，变更为 <code>/actuator/readiness</code>。</p><h3 id=扩展接口变更>扩展接口变更</h3><p>在 SOFABoot 3.x 中，提供四种方式扩展健康检查，分别是
+ HealthChecker
+ HealthIndicator(Spring Boot 原生)
+ ReactiveHealthIndicator(Spring Boot 原生)
+ ReadinessCheckCallback</p><p>这四个接口的扩展实现执行顺序是 HealthChecker &gt; HealthIndicator, ReactiveHealthIndicator &gt; ReadinessCheckCallback，相同接口的扩展实现执行顺序则遵循 Spring Boot 标准的方案。即扩展类可以额外实现两个标准的 Order 接口：</p><ul><li>org.springframework.core.Ordered</li><li>org.springframework.core.PriorityOrdered</li></ul><p>或者使用注解</p><ul><li>org.springframework.core.annotation.Order</li></ul><p>这些接口的扩展实现处理结果将会在健康检查结果查中展现。</p><h3 id=删除-sofabootbeforehealthcheckevent-事件>删除 SofaBootBeforeHealthCheckEvent 事件</h3><p>在 SOFABoot 2.x 中，我们没有提供支持对健康检查扩展实现进行排序，导致用户无法预期自身扩展执行时机。如上述，SOFABoot 3.x 支持各组件扩展实现的排序，因此该事件可以统一使用 <code>HealthChecker</code> 接口和高优先级顺序实现替代。其次，在 SOFABoot 2.x 中，<code>SofaBootBeforeHealthCheckEvent</code> 事件的处理逻辑结果并不会反应在健康检查结果中，使用 <code>HealthChecker</code> 替代之后，这部分逻辑处理自然变成健康检查的一部分，可供查看。</p><h3 id=删除-defaulthealthchecker-接口>删除 DefaultHealthChecker 接口</h3><p>使用 JDK8 默认方法特性，删除 DefaultHealthChecker 接口，用户可以直接使用 HealthChecker 接口替代 DefaultHealthChecker.</p><h3 id=删除-sofabootmiddlewareafterreadinesscheckcallback-和-sofabootafterreadinesscheckcallback-接口>删除 SofaBootMiddlewareAfterReadinessCheckCallback 和 SofaBootAfterReadinessCheckCallback 接口</h3><p>在 SOFABoot 2.x 中，这两个接口是两种场景下的健康检查回调；推荐 SOFABoot 官方 Starter 使用 SofaBootMiddlewareAfterReadinessCheckCallback，而业务应用推荐使用SofaBootAfterReadinessCheckCallback，框架将优先执行 SofaBootMiddlewareAfterReadinessCheckCallback 的扩展实现，然后执行 SofaBootAfterReadinessCheckCallback 的扩展实现。这样的设计有两个缺陷：
+ 两个接口本质没有区别，但是隐藏了先后顺序逻辑，给用户引入了额外的学习成本；
+ 只考虑了 SofaBootMiddlewareAfterReadinessCheckCallback 和 SofaBootAfterReadinessCheckCallback 两个接口的顺序，但无法保证相同接口实现的执行顺序。</p><p>SOFABoot 3.x 中则引入了统一的健康检查回调接口 ReadinessCheckCallback，无论是官方 Starter 还是业务都实现这个接口，顺序的控制则遵循 Spring Boot 标准的方案。即通过额外实现两个标准的 Order 接口：</p><ul><li>org.springframework.core.Ordered</li><li>org.springframework.core.PriorityOrdered</li></ul><p>或者使用注解</p><ul><li>org.springframework.core.annotation.Order</li></ul><p>控制各个扩展实现的执行顺序。</p><h2 id=版本查看>版本查看</h2><h3 id=调整-versions-endpoint-路径>调整 Versions Endpoint 路径</h3><p>在 SOFABoot 2.x 中，版本信息查看的 Endpoint 为 /sofaboot/versions ，而在 SOFABoot 3.0 中，变更为 /actuator/versions</p><h2 id=总结>总结</h2><p>以上是 SOFABoot 3.x 详细的变更记录，近期有升级或者试用的同学可以通过 <a href=https://github.com/sofastack/sofa-boot>Github</a> 联系，我们会及时的答复与支持。</p></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>资源</h2><a class=link href=https://github.com/sofastack>Github</a>
<a class=link href=https://gitee.com/sofastack/>Gitee</a>
<a class=link href=https://github.com/sofastack-guides>示例</a></div><div class=cate><h2 class=cate-title>社交媒体</h2><a class=link href=https://zhuanlan.zhihu.com/sofastack>知乎专栏</a>
<a class=link href=https://weibo.com/sofastack>新浪微博</a>
<a class=link href=https://twitter.com/sofastack_io>Twitter</a></div><div class=cate><h2 class=cate-title>参与进来</h2><a class=link href=https://github.com/sofastack/sofastack.tech/issues/new>反馈</a>
<a class=link href=https://github.com/sofastack/community>社区</a>
<a class=link href=https://github.com/sofastack/sofastack.tech/wiki>Wiki</a>
<a class=link href=mailto:sofa@alipay.cloud.com>Email</a>
<a class=link href=/hr/>加入我们</a></div><div class=cate><h2 class=cate-title>蚂蚁金服开源项目</h2><a class=link href=https://ant.design/>Ant Design</a>
<a class=link href=https://eggjs.org/>Egg</a>
<a class=link href=https://sqlflow.org>SQLFlow</a>
<a class=link href=https://tech.antfin.com/open-source>更多</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>微信公众号</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>钉钉群</p></div></div></div><div class=copyright><p>© 2019 - 2020 The SOFAStack Authors
<a href=http://beian.miit.gov.cn/>浙 ICP 备 16045294 号-3</a></p></div></footer></body></html>