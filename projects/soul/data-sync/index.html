<!doctype html><html><head><title>Data Synchronization Design · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?a02cb5c75097762223d5a815a03e0a15";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/><img class=logo src=/img/logo/dromara.jpg></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/community/><span>Community</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/projects/soul/data-sync/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/projects/>Projects</a>
<a class=navbar-item href=/guides/>Guides</a>
<a class=navbar-item href=/blog/>Blog</a>
<a class=navbar-item href=/activities/>Activity</a>
<a class=navbar-item href=/community/>Community</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/zh/projects/soul/data-sync/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"><div id=js-drawer class=ss-toc><div id=js-drawer-handle class=drawer-handle><svg class="icon icon-menu" aria-hidden="true"><use xlink:href="#icon-menu"/></svg><svg class="icon icon-close" aria-hidden="true"><use xlink:href="#icon-close"/></svg></div><div class=drawer-body><div class=header title="This is an asynchronous, high-performance, cross-language, responsive API gateway.">Soul<div class="ss-toc-list-card -hidden-mobile"><svg class="icon -hidden-mobile" aria-hidden="true"><use xlink:href="#icon-menu1"/></svg><div class=ss-tooltip><div class=toc-list><h4 class=title>Main Projects</h4><ul class=list><li class=item><a href=/projects/soul/overview>Soul</a></li><li class=item><a href=/projects/hmily/overview>Hmily</a></li><li class=item><a href=/projects/raincat/overview>Raincat</a></li><li class=item><a href=/projects/myth/overview>Myth</a></li></ul></div><div class=toc-list><h4 class=title>Incubating Projects</h4><ul class=list><li class=item><a href=/projects/hodor/overview>Hodor</a></li></ul></div><div class=toc-list><h4 class=title>Tool Projects</h4><ul class=list><li class=item><a href=https://hutool.cn/>Hutool</a></li><li class=item><a href=http://sa-token.dev33.cn>SaToken</a></li><li class=item><a href=http://forest.dtflyx.com/>Forest</a></li><li class=item><a href=https://github.com/dromara/koalas-rpc>KoalasRpc</a></li><li class=item><a href=https://jpom.io/>Jpom</a></li><li class=item><a href=https://yomahub.com/tlog/>TLog</a></li><li class=item><a href=https://yomahub.com/liteflow/>Liteflow</a></li><li class=item><a href=https://maxkey.top/>MaxKey</a></li><li class=item><a href=https://cubic.jiagoujishu.com/>Cubic</a></li><li class=item><a href=https://dromara.org/sureness>Sureness</a></li><li class=item><a href=http://dromara.gitee.io/image-combiner>ImageCombiner</a></li><li class=item><a href=/projects/jinx/overview>Jinx</a></li><li class=item><a href=/projects/athena/overview>Athena</a></li></ul></div></div></div></div><div class=body><ul class=leaf-section><li class=item><div class=link><a title=Home href=/projects/soul/overview>Home</a></div></li><li class=item><div class=link><a title=Team href=/projects/soul/team>Team</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Design>Design</a></div><ul class=leaf-section><li class=item><div class=link><a title="Database Design" href=/projects/soul/database-design>Database Design</a></div></li><li class=item><div class=link><a title=Config href=/projects/soul/config>Config</a></div></li><li class=item><div class="link -current"><a title=DataSync href=/projects/soul/data-sync>DataSync</a></div></li><li class=item><div class=link><a title=MetaData href=/projects/soul/meta-data>MetaData</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Admin>Admin</a></div><ul class=leaf-section><li class=item><div class=link><a title="Dictionary Management" href=/projects/soul/dictionary-management>Dictionary Management</a></div></li><li class=item><div class=link><a title="Plugin Handle Explanation" href=/projects/soul/plugin-handle-explanation>Plugin Handle Explanation</a></div></li><li class=item><div class=link><a title="Selector and Rule" href=/projects/soul/selector-and-rule>Selector and Rule</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Users Guide">Users Guide</a></div><ul class=leaf-section><li class=item><div class=link><a title="Set Up" href=/projects/soul/soul-set-up>Set Up</a></div></li><li class=item><div class=link><a title="Http Proxy" href=/projects/soul/http-proxy>Http Proxy</a></div></li><li class=item><div class=link><a title="Dubbo Proxy" href=/projects/soul/dubbo-proxy>Dubbo Proxy</a></div></li><li class=item><div class=link><a title="SpringCloud Proxy" href=/projects/soul/spring-cloud-proxy>SpringCloud Proxy</a></div></li><li class=item><div class=link><a title="Sofa RPC Proxy" href=/projects/soul/sofa-rpc-proxy>Sofa RPC Proxy</a></div></li><li class=item><div class=link><a title="Use Data Sync" href=/projects/soul/use-data-sync>Use Data Sync</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Register Center">Register Center</a></div><ul class=leaf-section><li class=item><div class=link><a title=Design href=/projects/soul/register-center-design>Design</a></div></li><li class=item><div class=link><a title=Access href=/projects/soul/register-center-access>Access</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Quick Start">Quick Start</a></div><ul class=leaf-section><li class=item><div class=link><a title=Dubbo href=/projects/soul/quick-start-dubbo>Dubbo</a></div></li><li class=item><div class=link><a title=Http href=/projects/soul/quick-start-http>Http</a></div></li><li class=item><div class=link><a title=Grpc href=/projects/soul/quick-start-grpc>Grpc</a></div></li><li class=item><div class=link><a title=SpringCloud href=/projects/soul/quick-start-springcloud>SpringCloud</a></div></li><li class=item><div class=link><a title=Sofa href=/projects/soul/quick-start-sofa>Sofa</a></div></li><li class=item><div class=link><a title=Tars href=/projects/soul/quick-start-tars>Tars</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Plugins>Plugins</a></div><ul class=leaf-section><li class=item><div class=link><a title="Divide Plugin" href=/projects/soul/divide-plugin>Divide Plugin</a></div></li><li class=item><div class=link><a title="Dubbo Plugin" href=/projects/soul/dubbo-plugin>Dubbo Plugin</a></div></li><li class=item><div class=link><a title="SpringCloud Plugin" href=/projects/soul/spring-cloud-plugin>SpringCloud Plugin</a></div></li><li class=item><div class=link><a title="Sofa Plugin" href=/projects/soul/sofa-plugin>Sofa Plugin</a></div></li><li class=item><div class=link><a title="RateLimiter Plugin" href=/projects/soul/rate-limiter-plugin>RateLimiter Plugin</a></div></li><li class=item><div class=link><a title="Hystrix Plugin" href=/projects/soul/hystrix-plugin>Hystrix Plugin</a></div></li><li class=item><div class=link><a title="Sentinel Plugin" href=/projects/soul/sentinel-plugin>Sentinel Plugin</a></div></li><li class=item><div class=link><a title="Resilience4j Plugin" href=/projects/soul/resilience4j-plugin>Resilience4j Plugin</a></div></li><li class=item><div class=link><a title="Monitor Plugin" href=/projects/soul/monitor-plugin>Monitor Plugin</a></div></li><li class=item><div class=link><a title="Waf Plugin" href=/projects/soul/waf-plugin>Waf Plugin</a></div></li><li class=item><div class=link><a title="Sign Plugin" href=/projects/soul/sign-plugin>Sign Plugin</a></div></li><li class=item><div class=link><a title="Rewrite Plugin" href=/projects/soul/rewrite-plugin>Rewrite Plugin</a></div></li><li class=item><div class=link><a title="Websocket Plugin" href=/projects/soul/websocket-plugin>Websocket Plugin</a></div></li><li class=item><div class=link><a title="Context Path Plugin" href=/projects/soul/context-path-plugin>Context Path Plugin</a></div></li><li class=item><div class=link><a title="Redirect Plugin" href=/projects/soul/redirect-plugin>Redirect Plugin</a></div></li><li class=item><div class=link><a title="Logging Plugin" href=/projects/soul/logging-plugin>Logging Plugin</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Developer Guide">Developer Guide</a></div><ul class=leaf-section><li class=item><div class=link><a title="Custom filter" href=/projects/soul/custom-filter>Custom filter</a></div></li><li class=item><div class=link><a title="Custom Plugin" href=/projects/soul/custom-plugin>Custom Plugin</a></div></li><li class=item><div class=link><a title="File and Image" href=/projects/soul/file-and-image>File and Image</a></div></li><li class=item><div class=link><a title="Custom parsing IP and Host" href=/projects/soul/custom-parsing-ip-and-host>Custom parsing IP and Host</a></div></li><li class=item><div class=link><a title="Custom Result" href=/projects/soul/custom-result>Custom Result</a></div></li><li class=item><div class=link><a title="Custom Sign Algorithm" href=/projects/soul/custom-sign-algorithm>Custom Sign Algorithm</a></div></li><li class=item><div class=link><a title="Developer Soul Client" href=/projects/soul/developer-soul-client>Developer Soul Client</a></div></li><li class=item><div class=link><a title=Thread href=/projects/soul/thread>Thread</a></div></li><li class=item><div class=link><a title="Soul Optimize" href=/projects/soul/soul-optimize>Soul Optimize</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Community>Community</a></div><ul class=leaf-section><li class=item><div class=link><a title=Contributor href=/projects/soul/contributor>Contributor</a></div></li><li class=item><div class=link><a title=Committer href=/projects/soul/committer>Committer</a></div></li><li class=item><div class=link><a title="Code Conduct" href=/projects/soul/code-conduct>Code Conduct</a></div></li><li class=item><div class=link><a title="Sign ICLA Guide" href=/projects/soul/icla>Sign ICLA Guide</a></div></li></ul></li><li class=item><div class=link><a title="Doc Download" href=/projects/soul/download>Doc Download</a></div></li></ul></div></div></div></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Data Synchronization Design</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/dromara.github.io/edit/master/content/en/projects/soul/data-sync/index.md>Edit</a></div><div class=meta>Update time: 2021-06-03</div></div><article class=typo><h2 id=description>Description</h2><p>This article mainly explains three ways of database synchronization and their principles.</p><h2 id=preface>Preface</h2><p>Gateway is the entrance of request and it is a very important part in micro service architecture, therefore the importance of gateway high availability is self-evident. When we use gateway, we have to change configuration such as flow rule, route rule for satisfying business requirement. Therefore, the dynamic configuration of the gateway is an important factor to ensure the high availability of the gateway. Then, how does <code>Soul</code> support dynamic configuration?</p><p>Anyone who has used <code>Soul</code> knows, <code>Soul</code> plugin are hot swap,and the selector, rule of all plugins are dynamic configured, they take effect immediately without restarting service.But during using <code>Soul</code> gateway, users also report many problems</p><ul><li>Rely on <code>zookeeper</code>, this troubles users who use <code>etcd</code> <code>consul</code> and <code>nacos</code> registry</li><li>Rely on <code>redis</code>,<code>influxdb</code>, I have not used the limiting plugin, monitoring plugin, why do I need these</li></ul><p>Therefore,we have done a partial reconstruction of <code>Soul</code>,after two months of version iteration,we released version <code>2.0</code></p><ul><li>Data Synchronization removes the strong dependence on <code>zookeeper</code>,and we add <code>http long polling</code> and <code>websocket</code></li><li>Limiting plugin and monitoring plugin realize real dynamic configuration,we use <code>admin</code> backend for dynamic configuration instead of <code>yml</code> configuration before</li></ul><p><em>Q: Someone may ask me,why don&rsquo;t you use configuration center for synchronization?</em></p><p>First of all, it will add extra costs, not only for maintenance, but also make <code>Soul</code> heavy; In addition, using configuration center, data format is uncontrollable and it is not convenient for <code>soul-admin</code> to do configuration management.</p><p><em>Q: Someone may also ask,dynamic configuration update?Every time I can get latest data from database or redis,why are you making it complicated?</em></p><p>As a gateway, soul cached all the configuration in the <code>HashMap</code> of JVM in order to provide higher response speed and we use local cache for every request, It&rsquo;s very fast. So this article can also be understood as three ways of memory synchronization in a distributed environment.</p><h2 id=principle-analysis>Principle Analysis</h2><p>This is a HD uncoded image, it shows the flow of <code>Soul</code> data synchronization, when <code>Soul</code> gateway starts, it will synchronize configuration data from the configuration service and support push-pull mode to obtain configuration change information, and update the local cache.When administrator changes user,rule,plugin,flow configuration in the backend, modified information will synchronize to the <code>Soul</code> gateway through the push-pull mode,whether it is the push mode or the pull mode depends on the configuration.About the configuration synchronization module, it is actually a simplified configuration center.
<img src="https://bestkobe.gitee.io/images/soul/soul-config-processor.png?_t=201908032316" alt="Soul Data Synchronization Flow Chart"></p><p>At version <code>1.x</code> ,configuration service depends on <code>zookeeper</code>,management backend <code>push</code> the modified information to gateway.But version <code>2.x</code> supports <code>webosocket</code>,<code>http</code>,<code>zookeeper</code>,it can specify the corresponding synchronization strategy through <code>soul.sync.strategy</code> and use <code>webosocket</code> synchronization strategy by default which can achieve second-level data synchronization.But,note that <code>soul-web</code> and <code>soul-admin</code> must use the same synchronization mechanism.</p><p>As showing picture below,<code>soul-admin</code> will issue a configuration change notification through <code>EventPublisher</code> after users change configuration,<code>EventDispatcher</code> will handle this modification and send configuration to corresponding event handler according to configured synchronization strategy(http,websocket,zookeeper)</p><ul><li>If it is a <code>websocket</code> synchronization strategy,it will push modified data to <code>soul-web</code>,and corresponding <code>WebsocketCacheHandler</code> handler will handle <code>admin</code> data push at the gateway layer</li><li>If it is a <code>zookeeper</code> synchronization strategy,it will push modified data to <code>zookeeper</code>,and the <code>ZookeeperSyncCache</code> will monitor the data changes of <code>zookeeper</code> and process them</li><li>If it is a <code>http</code> synchronization strategy,<code>soul-web</code> proactively initiates long polling requests,90 seconds timeout by default,if there is no modified data in <code>soul-admin</code>,http request will be blocked,if there is a data change, it will respond to the changed data information,if there is no data change after 60 seconds,then respond with empty data,gateway continue to make http request after getting response,this kind of request will repeat
<img src="https://bestkobe.gitee.io/images/soul/config-strage-processor.png?_t=201908032339" alt="Soul Configuration Synchronization Strategy Flow Chart"></li></ul><h2 id=zookeeper-synchronization>Zookeeper Synchronization</h2><p>The zookeeper-based synchronization principle is very simple,it mainly depends on <code>zookeeper</code> watch mechanism,<code>soul-web</code> will monitor the configured node,when <code>soul-admin</code> starts,all the data will be written to <code>zookeeper</code>,it will incrementally update the nodes of <code>zookeeper</code> when data changes,at the same time, <code>soul-web</code> will monitor the node for configuration information, and update the local cache once the information changes</p><p><img src=https://yu199195.github.io/images/soul/soul-zookeeper.png alt="Zookeeper Node Design"></p><p><code>soul</code> writes the configuration information to the zookeeper node,and it is meticulously designed.</p><h2 id=websocket-synchronization>WebSocket Synchronization</h2><p>The mechanism of <code>websocket</code> and <code>zookeeper</code> is similar,when the gateway and the <code>admin</code> establish a <code>websocket</code> connection,<code>admin</code> will push all data at once,it will automatically push incremental data to <code>soul-web</code> through <code>websocket</code> when configured data changes</p><p>When we use websocket synchronization,pay attention to reconnect after disconnection,which also called keep heartbeat.<code>soul</code> uses <code>java-websocket</code> ,a third-party library,to connect to <code>websocket</code>.</p><pre><code class=language-java>public class WebsocketSyncCache extends WebsocketCacheHandler {
    /**
     * The Client.
     */
    private WebSocketClient client;

    public WebsocketSyncCache(final SoulConfig.WebsocketConfig websocketConfig) {
        ScheduledThreadPoolExecutor executor = new ScheduledThreadPoolExecutor(1,
                SoulThreadFactory.create(&quot;websocket-connect&quot;, true));
         client = new WebSocketClient(new URI(websocketConfig.getUrl())) {
                @Override
                public void onOpen(final ServerHandshake serverHandshake) {
                  //....
                }
                @Override
                public void onMessage(final String result) {
                  //....
                }    
            };
        //connect
        client.connectBlocking();
        //reconnect after disconnection,using scheduling thread pool,execute every 30 seconds
        executor.scheduleAtFixedRate(() -&gt; {
            if (client != null &amp;&amp; client.isClosed()) {
                    client.reconnectBlocking();
            }
        }, 10, 30, TimeUnit.SECONDS);
    }
</code></pre><h2 id=http-long-polling>Http Long Polling</h2><p>The mechanism of zookeeper and websocket data synchronization is relatively simple,but http synchronization will be relatively complicated.Soul borrows the design ideas of <code>Apollo</code> and <code>Nacos</code> and realizes <code>http</code> long polling data synchronization using their advantages.Note that this is not traditional ajax long polling.</p><p><img src="https://bestkobe.gitee.io/images/soul/http-long-polling.png?_t=201908032339" alt="http long polling"></p><p>http long polling mechanism as above,soul-web gateway requests admin configuration services,timeout is 90 seconds,it means gateway layer request configuration service will wait at most 90 seconds,this is convenient for admin configuration service to respond modified data in time,and therefore we realize near real-time push.</p><p>After the http request reaches soul-admin, it does not respond immediately,but uses the asynchronous mechanism of Servlet3.0 to asynchronously respond to the data.First of all,put long polling request task <code>LongPollingClient</code> into <code>BlocingQueue</code>,and then start scheduling task,execute after 60 seconds,this aims to remove the long polling request from the queue after 60 seconds,even there is no configured data change.Because even if there is no configuration change,gateway also need to know,otherwise it will wait,and there is a 90 seconds timeout when the gateway requests configuration services.</p><pre><code class=language-java>public void doLongPolling(final HttpServletRequest request, final HttpServletResponse response) {
    // since soul-web may not receive notification of a configuration change, MD5 value may be different,so respond immediately
    List&lt;ConfigGroupEnum&gt; changedGroup = compareMD5(request);
    String clientIp = getRemoteIp(request);
    if (CollectionUtils.isNotEmpty(changedGroup)) {
        this.generateResponse(response, changedGroup);
        return;
    }

    // Servlet3.0 asynchronously responds to http request
    final AsyncContext asyncContext = request.startAsync();
    asyncContext.setTimeout(0L);
    scheduler.execute(new LongPollingClient(asyncContext, clientIp, 60));
}
    
class LongPollingClient implements Runnable {
    LongPollingClient(final AsyncContext ac, final String ip, final long timeoutTime) {
        // omit......
    }
    @Override
    public void run() {
        // join a scheduled task, if there is no configuration change within 60 seconds, it will be executed after 60 seconds and respond to http requests
        this.asyncTimeoutFuture = scheduler.schedule(() -&gt; {
            // clients are blocked queue,saved the request from soul-web
            clients.remove(LongPollingClient.this);
            List&lt;ConfigGroupEnum&gt; changedGroups = HttpLongPollingDataChangedListener.compareMD5((HttpServletRequest) asyncContext.getRequest());
            sendResponse(changedGroups);
        }, timeoutTime, TimeUnit.MILLISECONDS);
        // 
        clients.add(this);
    }
}
</code></pre><p>If the administrator changes the configuration data during this period,the long polling requests in the queue will be removed one by one, and respond which group’s data has changed(we distribute plugins, rules, flow configuration , user configuration data into different groups).After gateway receives response,it only knows which Group has changed its configuration,it need to request again to get group configuration data.Someone may ask,why don&rsquo;t you write out the changed data directly?We also discussed this issue deeply during development, because the http long polling mechanism can only guarantee quasi real-time,if gateway layer does not handle it in time,or administrator updates configuration frequently,we probably missed some configuration change push.For security, we only inform that a certain Group information has changed.</p><pre><code class=language-java>// soul-admin configuration changed,remove the requests from the queue one by one and respond to them
class DataChangeTask implements Runnable {
    DataChangeTask(final ConfigGroupEnum groupKey) {
        this.groupKey = groupKey;
    }
    @Override
    public void run() {
        try {
            for (Iterator&lt;LongPollingClient&gt; iter = clients.iterator(); iter.hasNext(); ) {
                LongPollingClient client = iter.next();
                iter.remove();
                client.sendResponse(Collections.singletonList(groupKey));
            }
        } catch (Throwable e) {
            LOGGER.error(&quot;data change error.&quot;, e);
        }
    }
}
</code></pre><p>When <code>soul-web</code> gateway layer receives the http response information,pull modified information(if exists),and then request <code>soul-admin</code> configuration service again,this will repeatedly execute.</p><h2 id=storage-address>Storage Address</h2><p>github: <a href=https://github.com/dromara/soul>https://github.com/dromara/soul</a></p><p>gitee: <a href=https://gitee.com/dromara/soul>https://gitee.com/dromara/soul</a></p><p>There also have video tutorials on the project homepage,you can go to watch it if needed.</p><h2 id=at-last>At Last</h2><p>This article introduces that,in order to optimize the response speed, <code>soul</code> as a highly available micro service gateway, its three ways to cache the configuration rule selector data locally.After learning this article,I believe you have a certain understanding of the popular configuration center,it may be easier to learn their codes,I believe you can also write a distributed configuration center.Version 3.0 is already under planning,and I believe it will definitely surprise you.</p></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/dromara>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>