<!doctype html><html><head><title>Ark Plugin · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome Dromara</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/sofa-boot/sofa-ark-ark-plugin/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome Dromara</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/sofa-boot/sofa-ark-ark-plugin/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Ark Plugin</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/edit/master/content/en/projects/sofa-boot/sofa-ark-ark-plugin/index.md>Edit</a></div><div class=meta>Update time: 2021-01-24</div></div><article class=typo><p>﻿This section will introduce the standard specifications and directory structure of <code>Ark Plugin</code> and how to use the maven plugin of <code>sofa-ark-plugin-maven-plugin</code> to package and release it.</p><h2 id=plugin-specifications>Plugin Specifications</h2><p>A standard <code>Ark Plugin</code> should meet the following specifications:</p><ul><li><p>The plugin should have a name (default is <code>${artifactId}</code>). At runtime, duplicate names are not allowed. In other words, the name will be used as the unique ID of <code>Ark Plugin</code>;</p></li><li><p>A plugin must be configured with a priority (default is 1,000): the lower the number, the higher the priority;</p></li><li><p>A plugin should be configured with no more than one entry class <code>activator</code>, a portal for the container startup plugin used to implement the <code>com.alipay.sofa.ark.spi.service.PluginActivator</code> interface class in a uniform way. The plugin with higher priority will start up first;</p></li><li><p>Import classes support both package and class levels. They are loaded first from other plugins;</p></li><li><p>Export classes support package and class levels. Plugins with higher priority will be exported first;</p></li><li><p>Support importing resources from the classpath (wildcard is not supported). Specified resources will be searched for from other plugins first;</p></li><li><p>Support exporting resources from the classpath (wildcard is not supported); resources with higher priority will be exported first;</p></li></ul><h2 id=maven-plugins>Maven plugins</h2><p>The officially provided <code>Maven</code> plugin <code>sofa-ark-plugin-maven-plugin</code> can package projects into a standard-format <code>Ark Plugin</code>. The coordinates of <code>Maven</code> plugin are:</p><pre><code class=language-xml>&lt;plugin&gt;
    &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
    &lt;artifactId&gt;sofa-ark-plugin-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;${sofa.ark.version}&lt;/version&gt;
&lt;/plugin&gt;
</code></pre><h2 id=goals>Goals</h2><p>The <code>sofa-ark-plugin-maven-plugin</code> plugin provides <code>goal: ark-plugin</code>, which can be used to package the project into a standard-format <code>Ark Plugin</code>. Configurations are as follows:</p><pre><code class=language-xml>&lt;build&gt;
    &lt;plugin&gt;
        &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
        &lt;artifactId&gt;sofa-ark-plugin-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;${sofa.ark.version}&lt;/version&gt;
        &lt;executions&gt;
            &lt;execution&gt;
                &lt;id&gt;default-cli&lt;/id&gt;
                &lt;goals&gt;
                    &lt;goal&gt;ark-plugin&lt;/goal&gt;
                &lt;/goals&gt;
            &lt;/excution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
            &lt;!-- Configuration information --&gt;
        &lt;/configuration&gt;
    &lt;/plugin&gt;
&lt;/build&gt;
</code></pre><h2 id=complete-configuration-template>Complete configuration template</h2><p>The complete configuration template of the <code>sofa-ark-plugin-maven-plugin</code> plugin is shown as follows:</p><pre><code class=language-xml>&lt;plugins&gt;
    &lt;plugin&gt;
        &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
        &lt;artifactId&gt;sofa-ark-plugin-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;${sofa.ark.version}&lt;/version&gt;
        &lt;executions&gt;
            &lt;execution&gt;
                &lt;id&gt;default-cli&lt;/id&gt;
                &lt;goals&gt;
                    &lt;goal&gt;ark-plugin&lt;/goal&gt;
                &lt;/goals&gt;

                &lt;configuration&gt;
    
                    &lt;!-- Specify the directory to package ${pluginName}.ark.plugin (${project. build. directory} is the default location) --&gt;
                    &lt;outputDirectory&gt;./&lt;/outputDirectory&gt;
    
                    &lt;!-- Specify whether or not to install or publish the Ark plugin to the repository. The default is true.  --&gt;
                    &lt;attach&gt;true&lt;/attach&gt;

                    &lt;!-- Ark plugin can specify at most one implementation class for the com.alipay.sofa.ark.spi.service.PluginActivator interface. --&gt;
                    &lt;activator&gt;com.alipay.sofa.ark.service.impl.SampleActivator&lt;/activator&gt;

                    &lt;!-- Configure the priority: the smaller the number, the higher the priority for startup and class export (the default is 1000) --&gt;
                    &lt;priority&gt;2000&lt;/priority&gt;

                    &lt;!-- Configure the plugin's name. Be sure to make it correct as it will be taken as the only identifier at runtime. The sofa-RPC plugin, for example, can be configued as sofa-RPC. The default is ${artifactId} --&gt;
                    &lt;pluginName&gt;${ark.plugin.name}&lt;/pluginName&gt;

                    &lt;!-- Configure imported classes and resources --&gt;
                    &lt;imported&gt;
                        &lt;!-- Configure the packages that need to be loaded from other Ark plugins first --&gt;
                        &lt;packages&gt;
                            &lt;package&gt;javax.servlet&lt;/package&gt;
                            &lt;package&gt;org.springframework.*&lt;/package&gt;
                        &lt;/packages&gt;

                        &lt;!-- Configure the classes that need to be loaded from other Ark plugins first --&gt;
                        &lt;classes&gt;
                            &lt;class&gt;com.alipay.sofa.rpc.config.ProviderConfig&lt;/class&gt;
                        &lt;/classes&gt;
                        
                        &lt;!-- Specify the resources that need to be loaded from other Ark plugins first --&gt;
                        &lt;resources&gt;
                            &lt;resource&gt;META-INF/spring/bean.xml&lt;/resource&gt;&gt;
                        &lt;/resources&gt;
                    &lt;/imported&gt;

                    &lt;!-- Configure exported classes and resources --&gt;
                    &lt;exported&gt;
                        &lt;!-- Configure exported classes of package level --&gt;
                        &lt;packages&gt;
                            &lt;package&gt;com.alipay.sofa.ark.service&lt;/package&gt;
                        &lt;/packages&gt;

                        &lt;!-- Configure exported classes of class level --&gt;
                        &lt;classes&gt;
                            &lt;class&gt;com.alipay.sofa.ark.common.CommonUtils&lt;/class&gt;
                            &lt;class&gt;com.alipay.sofa.mock&lt;/class&gt;
                        &lt;/classes&gt;
                        
                        &lt;!-- Configure the resources exported by Ark plugins --&gt;
                        &lt;resources&gt;
                            &lt;resource&gt;META-INF/spring/bean.xml&lt;/resource&gt;&gt;
                        &lt;/resources&gt;                        
                    &lt;/exported&gt;

                    &lt;!-- Exclude specified package dependencies when packaging plugins. The format is:  ${groupId:artifactId} or ${groupId:artifactId:classifier} --&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;org.apache.commons:commons-lang3&lt;/exclude&gt;
                    &lt;/excludes&gt;

                    &lt;!-- Exclude the package dependencies that have the same groupId as specified when packaging plugins --&gt;
                    &lt;excludeGroupIds&gt;
                        &lt;excludeGroupId&gt;org.springframework&lt;/excludeGroupId&gt;
                    &lt;/excludeGroupIds&gt;

                    &lt;!-- Exclude the package dependencies that have the same artifactId as specified when packaging plugins --&gt;
                    &lt;excludeArtifactIds&gt;
                        &lt;excludeArtifactId&gt;sofa-ark-spi&lt;/excludeArtifactId&gt;
                    &lt;/excludeArtifactIds&gt;

                &lt;/configuration&gt;
            &lt;/execution&gt;

        &lt;/executions&gt;
    &lt;/plugin&gt;
&lt;/plugins&gt;
</code></pre><p>The meaning of the configuration items are as follows:
+ <code>outputDirectory</code>: Specify the output directory of the ${pluginName}.ark.plugin; ${project.build.directory} is the default location;</p><ul><li><p><code>attach</code>: Specify whether to install and publish the Ark plugin to the repository (true by default);</p></li><li><p><code>activator</code>: Ark plugin can specify at most one implementation class for the <code>com.alipay.sofa.ark.spi.service.PluginActivator interface</code>;</p></li><li><p><code>priority</code>: Configure the priority: the smaller the number, the higher the priority for startup and class export (the default is 1000);</p></li><li><p><code>pluginName</code>: Configure the plugin&rsquo;s name. Be sure to make it correct as it will be taken as the only identifier at runtime. For example, the sofa-RPC plugin can be configured as sofa-RPC; the default value is ${artifactId}</p></li><li><p><code>imported</code>: Configure imported classes and resources. Note that when configuring imported classes of the package level, if the package name is suffixed with wildcard <code>*</code>, then all packages or classes with that package prefix will be imported. Otherwise, only classes that have the prefix will be imported but its sub-packages will not be imported.</p></li><li><p><code>exported</code>: Configure exported classes and resources. Note that when configuring exported classes of the package level, if the package name is suffixed with wildcard <code>*</code>, then all packages or classes with that package prefix will be imported. Otherwise, only classes that have the prefix will be exported but its sub-packages will not be exported.</p></li><li><p><code>excludes</code>: Exclude specified package dependencies when packaging plugins. The format is: ${groupId:artifactId} or ${groupId:artifactId:classifier};</p></li><li><p><code>excludeGroupIds</code>: Exclude package dependencies that have the same groupId as specified when packaging plugins;</p></li><li><p><code>excludeArtifactIds</code>: Exclude package dependencies that have the same artifactId as specified when packaging plugins;</p></li></ul><h2 id=constructing>Constructing</h2><p>For a common Java project, generating a standard <code>Ark Plugin</code> only needs three steps:
* Create an empty module under the project root directory to package the <code>Ark Plugin</code>, and define its coordinates, assuming:</p><pre><code class=language-xml>&lt;dependency&gt;
    &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
    &lt;artifactId&gt;sofa-ark-plugin-demo&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><ul><li><p>Add the third-party dependencies and other modules of the project in the module&rsquo;s pom.xml file, and configure the <code>sofa-ark-plugin-maven-plugin</code> plugin in the configuration template;</p></li><li><p>Tap the <code>mvn package</code> command under the module directory or the project root directory to generate the <code>ark-plugin-demo.ark.plugin</code> file in the configured <code>outputDirectory</code> directory. Tap the <code>mvn install</code> command to install the file in the local <code>Maven</code> repository;</p></li></ul><h2 id=publishing>Publishing</h2><p>Configure the repository address in the master pom file, and tap the <code>mvn deploy</code> command to publish the <code>Ark plugin</code>. Note that the coordinates of the <code>Ark Plugin</code> will be attached with <code>classifier = Ark-plugin</code>. For example, with the above configuration specified, the following coordinates will be generated for the <code>Ark Plugin</code>:</p><pre><code class=language-xml>&lt;dependency&gt;
    &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
    &lt;artifactId&gt;sofa-ark-plugin-demo&lt;/artifactId&gt;
    &lt;classifier&gt;ark-plugin&lt;/classifier&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>Other applications can reference the plugin via the coordinates.</p><h2 id=ark-plugin-typical-directory-structure>Ark Plugin typical directory structure</h2><pre><code class=language-text>.
│
├── com
│   └── alipay
│       └── sofa
│           └── ark
│               └── plugin
│                   └── mark
│
├── META-INF
│   └── MANIFEST.MF
│
├── conf
│   └── export.index
└── lib
    ├── commons-lang3-3.3.1.jar
    ├── sample-plugin-1.0.0.jar
    └── sample-plugin-common-1.0.0.jar
</code></pre><p>The files and directories under the above structure are described as follows:</p><ul><li><p><code>com/alipay/sofa/ark/plugin/mark</code>: A markup file that regards the JAR package as the <code>Ark Plugin</code> file generated by the <code>sofa-Ark-plugin-maven-plugin</code>.</p></li><li><p><code>META-INF/MANIFEST.MF</code>: It is used to record the plugin&rsquo;s meta information, whose content is like the following:</p><pre><code class=language-manifest>Manifest-Version: 1.0
groupId: com.alipay.sofa
artifactId: sample-plugin
version: 1.0.0
priority: 2000
pluginName: sample-demo-plugin
activator: com.alipay.sofa.ark.service.impl.SampleActivator
import-packages: javax.servlet,org.springframework
import-classes: com.alipay.sofa.rpc.config.ProviderConfig
export-packages: com.alipay.sofa.ark.service
export-classes: com.alipay.sofa.ark.common.CommonUtils,com.alipay.sofa.mock
</code></pre><ul><li><p><code>conf/export.index</code>: An index file of the plugin&rsquo;s exported classes. To avoid computing the exported classes under the <code>export-packages</code> at runtime, a corresponding index file will be generated when the Ark Plugin is packaged, thus shortening the time spent in parsing and configuring <code>Ark Container</code>. As for imported classes, we only need to load the configurations from the <code>META-INF/MANIFEST.MF</code> file and directly compare the prefixes of <code>import-packages</code> and <code>import-classes</code>, without need to generate an index file.</p></li><li><p><code>lib/</code>: The common JAR packages that the project depends on are placed in the lib directory, which generally contains the JAR package whose plugins need to be isolated from other plugins or services. All exported classes of the plugin&rsquo;s configuration are contained in these JAR packages.</p></li></ul></li></ul></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/shuaiqiyu>Gitee</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/soul/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div><div class=cate><h2 class=cate-title>Document</h2><a class=link href=/projects/soul/overview/>Soul</a>
<a class=link href=/projects/hmily/overview/>Hmily</a>
<a class=link href=/projects/raincat/overview/>Raincat</a>
<a class=link href=/projects/myth/overview/>Myth</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>QQ Group</p></div></div></div><div class=copyright><p>Copyright ©2021
<a href=/>xiaoyu@apache.org by xiaoyu</a></p></div></footer></body></html>