<!doctype html><html><head><title>Engine architecture · dromara(Open source organization)</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="SOFAStack is a Scalable Open Financial Architecture for building cloud native applications"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-142131411-1','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/sofa-jraft/engine-architecture/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/sofa-jraft/engine-architecture/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"><div id=js-drawer class=ss-toc><div id=js-drawer-handle class=drawer-handle><svg class="icon icon-menu" aria-hidden="true"><use xlink:href="#icon-menu"/></svg><svg class="icon icon-close" aria-hidden="true"><use xlink:href="#icon-close"/></svg></div><div class=drawer-body><div class=header title="SOFAJRaft is a production-level high-performance Java implementation based on the RAFT consensus algorithm. It supports MULTI-RAFT-GROUP and is suitable for high-load and low-latency scenarios.">SOFAJRaft<div class="ss-toc-list-card -hidden-mobile"><svg class="icon -hidden-mobile" aria-hidden="true"><use xlink:href="#icon-menu1"/></svg><div class=ss-tooltip><div class=toc-list><h4 class=title>Main Projects</h4><ul class=list><li class=item><a href=/en/projects/sofa-boot/overview>SOFABoot</a></li><li class=item><a href=/en/projects/sofa-rpc/overview>SOFARPC</a></li><li class=item><a href=/en/projects/sofa-tracer/overview>SOFATracer</a></li><li class=item><a href=/en/projects/sofa-lookout/overview>SOFALookout</a></li><li class=item><a href=/en/projects/sofa-registry/overview>SOFARegistry</a></li></ul></div><div class=toc-list><h4 class=title>Incubating Projects</h4><ul class=list><li class=item><a href=/en/projects/sofa-mesh/overview>SOFAMesh</a></li><li class=item><a href=/en/projects/sofa-dashboard/overview>SOFADashboard</a></li></ul></div><div class=toc-list><h4 class=title>Tool Projects</h4><ul class=list><li class=item><a href=/en/projects/sofa-bolt/overview>SOFABolt</a></li><li class=item><a href=/en/projects/sofa-jraft/overview>SOFAJRaft</a></li><li class=item><a href=/en/projects/sofa-acts/overview>SOFAActs</a></li><li class=item><a href=https://www.sofastack.tech/en/projects/sofa-boot/sofa-ark-readme/>SOFAArk</a></li></ul></div><div class=toc-list><h4 class=title>Ecosystem Projects</h4><ul class=list><li class=item><a href=https://mosn.io/en>MOSN</a></li><li class=item><a href=https://occlum.io>Occlum</a></li><li class=item><a href=https://seata.io>Seata</a></li></ul></div></div></div></div><div class=body><ul class=leaf-section><li class=item><div class=link><a title="SOFAJRaft overview" href=/en/projects/sofa-jraft/overview>SOFAJRaft overview</a></div></li><li class=item><div class="link -current"><a title="Engine architecture" href=/en/projects/sofa-jraft/engine-architecture>Engine architecture</a></div></li><li class=item><div class=link><a title="Jepsen tests" href=/en/projects/sofa-jraft/jepson-test>Jepsen tests</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="User guide">User guide</a></div><ul class=leaf-section><li class=item><div class=link><a title="JRaft user guide" href=/en/projects/sofa-jraft/jraft-user-guide>JRaft user guide</a></div></li><li class=item><div class=link><a title="JRaft RheaKV user guide" href=/en/projects/sofa-jraft/jraft-rheakv-user-guide>JRaft RheaKV user guide</a></div></li><li class=item><div class=link><a title="Counter example" href=/en/projects/sofa-jraft/counter-example>Counter example</a></div></li></ul></li><li class=item><div class=link><a title="Maven dependency description'" href=/en/projects/sofa-jraft/maven-dependency>Maven dependency description&#39;</a></div></li><li class=item><div class=link><a title="Release notes" href=/en/projects/sofa-jraft/release-log>Release notes</a></div></li><li class=item><div class=link><a title="Benchmark data" href=/en/projects/sofa-jraft/benchmark-performance>Benchmark data</a></div></li><li class=item><div class=link><a title="User stories" href=/en/projects/sofa-jraft/user-stories>User stories</a></div></li><li class=item><div class=link><a title=Roadmap href=/en/projects/sofa-jraft/road-map>Roadmap</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Related articles">Related articles</a></div><ul class=leaf-section><li class=item><div class=link><a title="Introduction to Raft algorithms" href=/en/projects/sofa-jraft/raft-introduction>Introduction to Raft algorithms</a></div></li><li class=item><div class=link><a title="Distributed consensus - Raft and JRaft" href=/en/projects/sofa-jraft/consistency-raft-jraft>Distributed consensus - Raft and JRaft</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Other>Other</a></div><ul class=leaf-section><li class=item><div class=link><a title="How to contribute to SOFAJRaft" href=/en/projects/sofa-jraft/how-to-contribute-code-to-sofajraft>How to contribute to SOFAJRaft</a></div></li></ul></li></ul></div></div></div></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Engine architecture</h1><a class="edit-button -hidden-mobile" href=https://github.com/dromara/edit/master/content/en/projects/sofa-jraft/engine-architecture/index.md>Edit</a></div><div class=meta>Update time: 2021-01-20</div></div><article class=typo><p>The engine architecture is shown in the following diagram.
<img src=engine.png alt=jraft_engine></p><h3 id=node>Node</h3><p>A node in a Raft cluster connects and encapsulates all underlayer service modules, and main service interfaces that are visible to users. Specifically, the leader node of a raft group calls <code>apply(task)</code> to commit new tasks to the state machine replication cluster made up by the Raft group, which will then apply the task to the business state machine.</p><h2 id=storage>Storage</h2><ol><li>It stores Raft configuration changes and log entries converted from requests submitted by users, and replicates log entries from the leader&rsquo;s log to followers&rsquo; logs. LogStorage stores logs, while LogManager is responsible for calling the underlayer storage, caching and batch submitting storage calls, and conducting necessary checks and optimization.</li><li>MetaStorage stores the metadata and records the internal states of the Raft implementation, for example, the current term of the node and the node to vote for.</li><li>Optional. Snapshot storage is used to store users&rsquo; state-machine snapshots and meta information. SnapshotStorage stores snapshots, while SnapshotExecutor manages the actual storage, remote installation, and replication of snapshots.</li></ol><h2 id=state-machine>State machine</h2><ol><li>StateMachine is an implementation of users&rsquo; core logic. It calls the <code>onApply(Iterator)</code> method to apply log entries that are submitted with <code>Node#apply(task)</code> to the business state machine.</li><li>FSMCaller encapsulates state transition calls that are sent to the User StateMachine, writes log entries, implements a finite-state machine (FSM), conducts necessary checks, and merges requests for batch submission and concurrent processing.</li></ol><h2 id=replication>Replication</h2><ol><li>Replicator is used by the leader to replicate log entries to followers. It does the same thing as an AppendEntries RPC of Raft. Without log entries, it is sent by the leader as heartbeats.</li><li>ReplicatorGroup is used by a Raft group to manage all replicators, and to perform necessary permission checks and dispatches.</li></ol><h2 id=rpc>RPC</h2><p>The RPC module is used for network communication between nodes.</p><ol><li>The RPC server is built in a node to receive requests from other nodes or clients, and to redirect such requests to the corresponding service modules.</li><li>The RPC client is used to issue requests to other nodes, such as requests for votes, log replication requests, and heartbeats.</li></ol></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/dromara>Github</a>
<a class=link href=https://gitee.com/sofastack/>Gitee</a>
<a class=link href=https://github.com/dromara-guides>Samples</a></div><div class=cate><h2 class=cate-title>Social Media</h2><a class=link href=https://zhuanlan.zhihu.com/sofastack>Zhihu</a>
<a class=link href=https://weibo.com/sofastack>Weibo</a>
<a class=link href=https://twitter.com/sofastack_io>Twitter</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/dromara/issues>Feedback</a>
<a class=link href=https://github.com/dromara/community>Community</a>
<a class=link href=https://github.com/dromara/wiki>Wiki</a>
<a class=link href=mailto:sofa@alipay.cloud.com>Email</a></div><div class=cate><h2 class=cate-title>Ant Financial Open Source</h2><a class=link href=https://ant.design/>Ant Design</a>
<a class=link href=https://eggjs.org/>Egg</a>
<a class=link href=https://sqlflow.org>SQLFlow</a>
<a class=link href=https://tech.antfin.com/open-source>More</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>DingTalk Group</p></div></div></div><div class=copyright><p>© 2019 - 2020 The SOFAStack Authors
<a href=http://beian.miit.gov.cn/>浙 ICP 备 16045294 号-3</a></p></div></footer></body></html>