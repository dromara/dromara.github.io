<!doctype html><html><head><title>OpenFeign Integration · SOFAStack</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="SOFAStack is a Scalable Open Financial Architecture for building cloud native applications"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=https://gw.alipayobjects.com/os/q/cms/images/jqu9346l/4ba95631-2489-4885-881f-bc7f8d787d5e_w64_h61.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-142131411-1','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link href=/en/><img class=logo src=/img/logo.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/en/projects/><span>Projects</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/guides/><span>Guides</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/en/activities/><span>Activity</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome SOFA</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/sofa-tracer/usage-of-openfeign/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/en/projects/>Projects</a>
<a class=navbar-item href=/en/guides/>Guides</a>
<a class=navbar-item href=/en/blog/>Blog</a>
<a class=navbar-item href=/en/activities/>Activity</a>
<a class=navbar-item href=/awesome/>Awesome SOFA</a></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/projects/sofa-tracer/usage-of-openfeign/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"><div id=js-drawer class=ss-toc><div id=js-drawer-handle class=drawer-handle><svg class="icon icon-menu" aria-hidden="true"><use xlink:href="#icon-menu"/></svg><svg class="icon icon-close" aria-hidden="true"><use xlink:href="#icon-close"/></svg></div><div class=drawer-body><div class=header title="SOFATracer is a distributed link tracing system based on OpenTracing specification.">SOFATracer<div class="ss-toc-list-card -hidden-mobile"><svg class="icon -hidden-mobile" aria-hidden="true"><use xlink:href="#icon-menu1"/></svg><div class=ss-tooltip><div class=toc-list><h4 class=title>Main Projects</h4><ul class=list><li class=item><a href=/en/projects/sofa-boot/overview>SOFABoot</a></li><li class=item><a href=/en/projects/sofa-rpc/overview>SOFARPC</a></li><li class=item><a href=/en/projects/sofa-tracer/overview>SOFATracer</a></li><li class=item><a href=/en/projects/sofa-lookout/overview>SOFALookout</a></li><li class=item><a href=/en/projects/sofa-registry/overview>SOFARegistry</a></li></ul></div><div class=toc-list><h4 class=title>Incubating Projects</h4><ul class=list><li class=item><a href=/en/projects/sofa-mesh/overview>SOFAMesh</a></li><li class=item><a href=/en/projects/sofa-dashboard/overview>SOFADashboard</a></li></ul></div><div class=toc-list><h4 class=title>Tool Projects</h4><ul class=list><li class=item><a href=/en/projects/sofa-bolt/overview>SOFABolt</a></li><li class=item><a href=/en/projects/sofa-jraft/overview>SOFAJRaft</a></li><li class=item><a href=/en/projects/sofa-acts/overview>SOFAActs</a></li><li class=item><a href=https://www.sofastack.tech/en/projects/sofa-boot/sofa-ark-readme/>SOFAArk</a></li></ul></div><div class=toc-list><h4 class=title>Ecosystem Projects</h4><ul class=list><li class=item><a href=https://mosn.io/en>MOSN</a></li><li class=item><a href=https://occlum.io>Occlum</a></li><li class=item><a href=https://seata.io>Seata</a></li></ul></div></div></div></div><div class=body><ul class=leaf-section><li class=item><div class=link><a title="SOFATracer overview" href=/en/projects/sofa-tracer/overview>SOFATracer overview</a></div></li><li class=item><div class=link><a title=Terminologies href=/en/projects/sofa-tracer/explanation>Terminologies</a></div></li><li class=item><div class=link><a title="TraceId and spanId generation rule" href=/en/projects/sofa-tracer/traceid-generated-rule>TraceId and spanId generation rule</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Quick start guide">Quick start guide</a></div><ul class=leaf-section><li class=item><div class=link><a title="Spring MVC Integration" href=/en/projects/sofa-tracer/usage-of-mvc>Spring MVC Integration</a></div></li><li class=item><div class=link><a title="HttpClient Integration" href=/en/projects/sofa-tracer/usage-of-httpclient>HttpClient Integration</a></div></li><li class=item><div class=link><a title="DataSource Integration" href=/en/projects/sofa-tracer/usage-of-datasource>DataSource Integration</a></div></li><li class=item><div class=link><a title="RestTemplate Integration" href=/en/projects/sofa-tracer/usage-of-resttemplate>RestTemplate Integration</a></div></li><li class=item><div class=link><a title="OkHttp Integration" href=/en/projects/sofa-tracer/usage-of-okhttp>OkHttp Integration</a></div></li><li class=item><div class=link><a title="Dubbo Integration" href=/en/projects/sofa-tracer/usage-of-dubbo>Dubbo Integration</a></div></li><li class=item><div class="link -current"><a title="OpenFeign Integration" href=/en/projects/sofa-tracer/usage-of-openfeign>OpenFeign Integration</a></div></li></ul></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title=Features>Features</a></div><ul class=leaf-section><li class=item><div class=link><a title="Print traceId and spanId in application log" href=/en/projects/sofa-tracer/print-traceid-spanid>Print traceId and spanId in application log</a></div></li><li class=item><div class=link><a title="Asynchronous thread processing" href=/en/projects/sofa-tracer/async>Asynchronous thread processing</a></div></li><li class=item><div class=link><a title="Sampling modes" href=/en/projects/sofa-tracer/sampler>Sampling modes</a></div></li><li class=item><div class=link><a title="Report data to Zipkin" href=/en/projects/sofa-tracer/report-to-zipkin>Report data to Zipkin</a></div></li></ul></li><li class=item><div class=link><a title="SOFATracer Tools" href=/en/projects/sofa-tracer/utils>SOFATracer Tools</a></div></li><li class=item><div class=link><a title="SOFATracer configuration items" href=/en/projects/sofa-tracer/configuration>SOFATracer configuration items</a></div></li><li class=item><div class=link><svg class="icon arrow" aria-hidden="true"><use xlink:href="#icon-arrow"/></svg><a title="Log format">Log format</a></div><ul class=leaf-section><li class=item><div class=link><a title="Spring MVC log" href=/en/projects/sofa-tracer/log-format-springmvc>Spring MVC log</a></div></li><li class=item><div class=link><a title="HttpClient log" href=/en/projects/sofa-tracer/log-format-httpclient>HttpClient log</a></div></li><li class=item><div class=link><a title="DataSource log" href=/en/projects/sofa-tracer/log-format-datasource>DataSource log</a></div></li><li class=item><div class=link><a title="SOFARPC log" href=/en/projects/sofa-tracer/log-format-sofarpc>SOFARPC log</a></div></li><li class=item><div class=link><a title="OkHttp log" href=/en/projects/sofa-tracer/log-format-okhttp>OkHttp log</a></div></li><li class=item><div class=link><a title="RestTemplate log" href=/en/projects/sofa-tracer/log-format-resttemplate>RestTemplate log</a></div></li><li class=item><div class=link><a title="Dubbo log" href=/en/projects/sofa-tracer/log-format-dubbo>Dubbo log</a></div></li><li class=item><div class=link><a title="OpenFeign log" href=/en/projects/sofa-tracer/log-format-openfeign>OpenFeign log</a></div></li></ul></li></ul></div></div></div></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>OpenFeign Integration</h1><a class="edit-button -hidden-mobile" href=https://github.com/sofastack/sofastack.tech/edit/master/content/en/projects/sofa-tracer/usage-of-openfeign/index.md>Edit</a></div><div class=meta>Update time: 2021-01-20</div></div><article class=typo><h1 id=openfeign-integration>OpenFeign Integration</h1><p>In this document will demonstrate how to use SOFATracer to track of OpenFeign.</p><h2 id=prepare-environment>Prepare Environment</h2><p>The versions of the framework components used in this case are as follows:</p><ul><li>Spring Cloud Greenwich.RELEASE</li><li>SOFABoot 3.1.1/SpringBoot 2.1.0.RELEASE</li><li>SOFATracer 3.0.4</li><li>JDK 8</li></ul><p>This case includes two submodules:</p><ul><li>tracer-sample-with-openfeign-provider service provider</li><li>tracer-sample-with-openfeign-consumer service consumer</li></ul><h2 id=new-sofaboot-project-as-parent-project>New SOFABoot project as parent project</h2><p>After creating a Spring Boot project, you need to introduce the SOFABoot&rsquo;s dependency. First, you need to unzip the generated <code>zip</code> package of Spring Boot project and modify the Maven project configuration file <code>pom.xml</code>.</p><pre><code class=language-xml>&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;${spring.boot.version}&lt;/version&gt;
    &lt;relativePath/&gt;
&lt;/parent&gt;
</code></pre><p>Replace the above with the followings:</p><pre><code class=language-xml>&lt;parent&gt;
    &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
    &lt;artifactId&gt;sofaboot-dependencies&lt;/artifactId&gt;
    &lt;version&gt;${sofa.boot.version}&lt;/version&gt;
&lt;/parent&gt;
</code></pre><p>The <code>${sofa.boot.version}</code> specifies the latest version of SOFABoot. For more information about SOFABoot versions, refer to <a href=https://github.com/sofastack/sofa-boot/releases>Release notes</a>.</p><h2 id=new-tracer-sample-with-openfeign-provider-module>New tracer-sample-with-openfeign-provider Module</h2><ul><li><p>Introducing dependence</p><pre><code class=language-xml>&lt;dependency&gt;
    &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
    &lt;artifactId&gt;tracer-sofa-boot-starter&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><blockquote><p>SOFATracer versions are controlled by SOFABoot versions. If the SOFABoot versions used do not match, you need to manually specify a tracer version that is higher than 3.0.4.</p></blockquote><ul><li><code>application.properties</code> Configuration</li></ul><pre><code class=language-properties>spring.application.name=tracer-provider
server.port=8800
spring.cloud.zookeeper.connect-string=localhost:2181
spring.cloud.zookeeper.discovery.enabled=true
spring.cloud.zookeeper.discovery.instance-id=tracer-provider
</code></pre></li><li><p>Simple resource class</p><pre><code class=language-java>@RestController
public class UserController {
    @RequestMapping(&quot;/feign&quot;)
    public String testFeign(HttpServletRequest request) {
        return &quot;hello tracer feign&quot;;
    }
}
</code></pre><h2 id=new-tracer-sample-with-openfeign-consumer-module>New tracer-sample-with-openfeign-consumer Module</h2><ul><li>Introducing dependence</li></ul><pre><code class=language-xml>&lt;dependency&gt;
    &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
    &lt;artifactId&gt;tracer-sofa-boot-starter&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre></li><li><p><code>application.properties</code> Configuration</p><pre><code class=language-properties>spring.application.name=tracer-consumer
server.port=8082
spring.cloud.zookeeper.connect-string=localhost:2181
spring.cloud.zookeeper.discovery.enabled=true
spring.cloud.zookeeper.discovery.instance-id=tracer-consumer
</code></pre><ul><li>Define the feign resource</li></ul><pre><code class=language-java>@FeignClient(value = &quot;tracer-provider&quot;,fallback = FeignServiceFallbackFactory.class)
public interface FeignService {
    @RequestMapping(value = &quot;/feign&quot;, method = RequestMethod.GET)
    String testFeign();
}
</code></pre></li><li><p>User @EnableFeignClients And @EnableDiscoveryClient</p><pre><code class=language-java>@SpringBootApplication
@RestController
@EnableDiscoveryClient
@EnableFeignClients
public class FeignClientApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(FeignClientApplication.class,args);
    }
    
    @Autowired
    private FeignService feignService;
    
    @RequestMapping
    public String test(){
        return feignService.testFeign();
    }
}
</code></pre><h2 id=test>Test</h2><p>Start tracer-sample-with-openfeign-provider and tracer-sample-with-openfeign-consumer two projects; then browser access:<a href=http://localhost:8082/>Http://localhost:8082/</a> . Then check the log:</p><p>In the <code>application.properties</code>, the log printing directory we configured is <code>./logs</code>, which is the root directory of the current application (we can configure it based on actual situation). In the root directory, you can see log files in the structure similar to the followings:</p><p>```</p></li></ul><p>./logs
├── spring.log
└── tracelog
├── feign-digest.log
├── feign-stat.log
├── spring-mvc-digest.log
├── spring-mvc-stat.log
├── static-info.log
└── tracer-self.log</p><pre><code>
In the example, you can see logs like the following in feign-digest.log

```json
{&quot;time&quot;:&quot;2019-03-28 18:08:06.800&quot;,&quot;local.app&quot;:&quot;tracer-consumer&quot;,&quot;traceId&quot;:&quot;0a0fe88f1553767685981100124403&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://10.15.232.143:8800/feign&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;error&quot;:&quot;&quot;,&quot;req.size.bytes&quot;:0,&quot;resp.size.bytes&quot;:18,&quot;time.cost.milliseconds&quot;:206,&quot;current.thread.name&quot;:&quot;http-nio-8082-exec-1&quot;,&quot;remote.host&quot;:&quot;10.15.232.143&quot;,&quot;remote.port&quot;:&quot;&quot;,&quot;component.client.impl&quot;:&quot;open-feign&quot;,&quot;baggage&quot;:&quot;&quot;}
</code></pre></article></main></div><footer class=ss-footer><div class=container><div class=links><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/sofastack>Github</a>
<a class=link href=https://gitee.com/sofastack/>Gitee</a>
<a class=link href=https://github.com/sofastack-guides>Samples</a></div><div class=cate><h2 class=cate-title>Social Media</h2><a class=link href=https://zhuanlan.zhihu.com/sofastack>Zhihu</a>
<a class=link href=https://weibo.com/sofastack>Weibo</a>
<a class=link href=https://twitter.com/sofastack_io>Twitter</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/sofastack/sofastack.tech/issues>Feedback</a>
<a class=link href=https://github.com/sofastack/community>Community</a>
<a class=link href=https://github.com/sofastack/sofastack.tech/wiki>Wiki</a>
<a class=link href=mailto:sofa@alipay.cloud.com>Email</a></div><div class=cate><h2 class=cate-title>Ant Financial Open Source</h2><a class=link href=https://ant.design/>Ant Design</a>
<a class=link href=https://eggjs.org/>Egg</a>
<a class=link href=https://sqlflow.org>SQLFlow</a>
<a class=link href=https://tech.antfin.com/open-source>More</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/qrcode_1.png><p class=qrcode-desc>Wechat Official Account</p></div><div><img class=qrcode-img src=/img/qrcode/qrcode_2.png><p class=qrcode-desc>DingTalk Group</p></div></div></div><div class=copyright><p>© 2019 - 2020 The SOFAStack Authors
<a href=http://beian.miit.gov.cn/>浙 ICP 备 16045294 号-3</a></p></div></footer></body></html>