---
title: è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼šTestHub V1.0.3 ç‰ˆæœ¬å‘å¸ƒ
author: TestHub
tag:
  - TestHub
date: 2024-01-25
cover: /assets/img/news/TestHub-1.0.2-1.jpg
head:
  - - meta
    - name: æ–°é—»
---

# è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼šTestHub V1.0.3 ç‰ˆæœ¬å‘å¸ƒ

## ç®€ä»‹

TestHub æ˜¯ä¸€æ¬¾åŸºäºæµç¨‹ç¼–æ’çš„è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ã€‚æ˜¯ä¸ºäº†è§£å†³åœ¨è½¯ä»¶å¼€å‘æ—…ç¨‹ä¸­æµ‹è¯•æµç¨‹ç®¡ç†å’Œæ‰§è¡Œçš„å¤æ‚æŒ‘æˆ˜è€Œè¯ç”Ÿçš„ã€‚ä¼ ç»Ÿæµ‹è¯•å·¥å…·å¯èƒ½å±€é™äºæ¥å£çº§è‡ªåŠ¨åŒ–ï¼Œæ— æ³•æ»¡è¶³å¤šæ ·åŒ–çš„éœ€æ±‚ï¼Œè€Œæˆ‘ä»¬åœ¨ TestHub ä¸­å¼•å…¥äº†ç‹¬ç‰¹çš„æµç¨‹ç¼–æ’åŠŸèƒ½ï¼Œè®©æ‚¨èƒ½å¤Ÿè½»æ¾å®šä¹‰ã€ç®¡ç†å’Œæ‰§è¡Œæµ‹è¯•æµç¨‹ã€‚æ— è®ºæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•ã€æµç¨‹è°ƒåº¦è¿˜æ˜¯å…¶ä»–è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼ŒTestHub çš„æ’ä»¶å¼æ¶æ„éƒ½èƒ½å¤Ÿæ»¡è¶³æ‚¨çš„æ— é™æ‰©å±•éœ€æ±‚ã€‚

ä½¿ç”¨æ‰‹å†Œï¼šhttp://nsrule.com/

æ¼”ç¤ºç¯å¢ƒï¼šhttp://testhub.nsrule.com:11018/#/

Gitee å¼€æºåœ°å€ï¼šhttps://gitee.com/dromara/TestHub

Gitub å¼€æºåœ°å€ï¼šhttps://github.com/dromara/TestHub

æ¼”ç¤ºè§†é¢‘ï¼šhttps://www.bilibili.com/video/BV1X94y1v7ak/

å®‰è£…åŒ…ï¼šhttps://url37.ctfile.com/d/42659137-59604925-26bdd9?p=3710 (è®¿é—®å¯†ç : 3710)

![](/assets/img/news/TestHub-1.0.2-1.jpg)

## 1.0.3 æ›´æ–°å†…å®¹

- ğŸª²ğŸª² ä¿®å¤ BUGğŸª²ğŸª²

- ä¼˜åŒ–ç”¨ä¾‹ç¼–è¾‘å™¨å¡é¡¿é—®é¢˜
- ä¿®å¤ HTTP ä¸æ”¯æŒå¼‚æ­¥æ¥å£èƒ½é—®é¢˜
- è‡ªåŠ¨ç”Ÿæˆçš„ ID å’Œäººå·¥è¾“å…¥çš„ ID å¯èƒ½ä¼šäº§ç”Ÿé‡å¤@magic(æ„Ÿè°¢å¤§ä½¬) #I8AZW1

- ğŸ‘ğŸ‘ æ–°å¢åŠŸèƒ½ ğŸ‘ğŸ‘

- ä¼˜åŒ– Formula è¡¨è¾¾å¼æ—¥å¿—å±•ç¤ºã€‚ä½¿ç”¨è¯´æ˜
- åŸºäº antlr4 é‡æ„ Formula è¡¨è¾¾å¼
- æ”¯æŒæ“ä½œ cookie #I8I89D
- å‚æ•°æ”¯æŒå¤åˆ¶é”®å…¥ #I8B27J
- ä¼˜åŒ–ç¯å¢ƒå˜é‡çš„ä½¿ç”¨ #I8CEPE

## å¦‚ä½•ä½¿ç”¨ Formula è¡¨è¾¾å¼

**â“ ä¸ºä»€ä¹ˆè¦åŸºäº antlr4 é‡æ„ Formula è¡¨è¾¾å¼ â“**

ANTLR (ANother Tool for Language Recognition) æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è¯­æ³•åˆ†æå™¨ç”Ÿæˆå·¥å…·ï¼Œç”¨äºç”Ÿæˆè¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨ã€‚ANTLR4 æ˜¯å…¶æœ€æ–°ç‰ˆæœ¬ï¼Œå…·æœ‰è®¸å¤šå…ˆè¿›çš„åŠŸèƒ½ï¼Œå®ƒæœ‰ä¸€äº›ä¼˜åŠ¿ä½¿å…¶åœ¨ä¸€äº›æƒ…å†µä¸‹æ¯” TestHub ä¹‹å‰ç‰ˆæœ¬æ‰‹åŠ¨è§£ææ›´æœ‰ä¼˜åŠ¿ï¼Œè€Œä¸”æ”¯æŒçš„è¯­æ³•æ›´å¤šã€‚

Formula è¡¨è¾¾å¼åšä¸ºæ“ä½œæ•°æ˜¯ TestHub æ•°æ®çš„æœ€å°æ“ä½œå•å…ƒ,

æˆ‘ä»¬ç”¨ FormulaNode è¡¨ç¤ºä¸€ä¸ªçš„æ“ä½œæ•° - TestHub ä¸­å†…ç½®äº† 5 ç§åŸºç¡€æ“ä½œæ•°

- DataNode è¡¨ç¤ºå›ºå®šå€¼,æ˜¯æœ‰é…ç½®äººå‘˜æ‰‹åŠ¨æŒ‡å®šçš„, ä¾‹å¦‚:`xxxx`
- PathNode è¡¨ç¤ºå˜é‡å€¼,å¯ä»¥åŸºäº jsonPath ä»å†³ç­–ä¸Šä¸‹æ–‡ä¸­è·å–æŒ‡å®šçš„å˜é‡å€¼,æ ‡è¯†ä¸º`${xxx.yyy}`
- FuncNode è¡¨ç¤ºæ–¹æ³•å‹å‡½æ•°çš„è°ƒç”¨,æ ‡è¯†ä¸º`%{æ–¹æ³•å(å½¢å‚ 1:æ“ä½œæ•°,......)}`
- ArithmeticNode è¡¨ç¤ºè®¡ç®—ç®—æ•°è¿ç®—, ä¾‹å¦‚:`1+2+3*4/5%3`
- MixNode è¡¨ç¤ºæ··åˆè¡¨è¾¾å¼

### æ“ä½œå¯¹è±¡

åç»­ä»‹ç»å‡ä»¥ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨å¦‚ä¸‹æ•°æ®ä¸ºå‰æ

```
{
  "store": {
    "book": [
      {
        "category": "reference",
        "author": "Nigel Rees",
        "title": "Sayings of the Century",
        "price": 8.95
      },
      {
        "category": "fiction",
        "author": "Evelyn Waugh",
        "title": "Sword of Honour",
        "price": 12.99
      },
      {
        "category": "fiction",
        "author": "Herman Melville",
        "title": "Moby Dick",
        "isbn": "0-553-21311-3",
        "price": 8.99
      },
      {
        "category": "fiction",
        "author": "J. R. R. Tolkien",
        "title": "The Lord of the Rings",
        "isbn": "0-395-19395-8",
        "price": 22.99
      }
    ],
    "bicycle": {
      "color": "red",
      "price": 19.95
    }
  },
  "expensive": 2
}
```

### è¯­æ³•

#### å›ºå®šå€¼-DataNode

data="root"ä¸­çš„ æˆ‘ä»¬å†™æ­»çš„ root å…¶å®å°±æ˜¯ DataNode ç±»å‹çš„æ“ä½œæ•°

```
<param code="password" name = "å¯†ç " dataType="STRING" data="root"/>
```

| å†™æ³•                   | ä¾‹å­                                                     | å€¼                         |
| ---------------------- | -------------------------------------------------------- | -------------------------- |
| `-1.0086`              | æ•°å­—                                                     | \-1.0086                   |
| `{attr:{a:1},attr1:1}` | json å¯¹è±¡                                                | {"attr":{"a":1},"attr1":1} |
| `[${expensive},1]`     | åˆ—è¡¨ æ“ä½œå¯¹è±¡çš„ expensive åšä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ1 æ˜¯ç¬¬äºŒä¸ªå…ƒç´  | `[2,1]`                    |

#### å˜é‡å€¼-PathNode

::: warning PathNode å‡ ä¹æ”¯æŒäº†æ‰€æœ‰ jsonPath çš„è¯­æ³•,ä½†æ˜¯æˆ‘ä»¬ä¸æ”¯æŒ `$['store']['book'][0]['title']` è¿™ç§`[]`çš„å†™æ³• å¦‚æœç›®å‰çš„è¯­æ³•æ»¡è¶³ä¸äº†ä½ çš„æµ‹è¯•è¿‡ç¨‹ï¼Œè¯·äº`gitee`ä»“åº“æ lssuesï¼Œæˆ‘ä»¬ä¼šä¼˜å…ˆæ”¯æŒã€‚ jsonPath è¯­æ³•å­¦ä¹  è¯·å‚è€ƒ https://github.com/alibaba/fastjson/wiki/JSONPath
:::

| å†™æ³•                                       | ä¾‹å­                                                                | å€¼                                         |
| ------------------------------------------ | ------------------------------------------------------------------- | ------------------------------------------ |
| `${expensive}`                             | æ“ä½œå¯¹è±¡çš„ expensive çš„å€¼                                           | 2                                          |
| `${store.book.price}`                      | æ“ä½œå¯¹è±¡çš„ store çš„æ¯ä¸€ä¸ª book çš„ price å€¼                          | `[8.95, 12.99, 8.99, 22.99]`               |
| `${store.book[-1].author}`                 | æ“ä½œå¯¹è±¡çš„ store çš„æœ€åä¸€ä¸ª book çš„ author                          | J. R. R. Tolkien                           |
| `${store.book[0:2].author}`                | æ“ä½œå¯¹è±¡çš„ store çš„ 0 åˆ° 2book çš„ author                            | Nigel Rees,Sword of Honour,Herman Melville |
| `${store.book[?(isbn)]}`                   | æ“ä½œå¯¹è±¡çš„ store çš„ book ä¸­ isbn å±æ€§ä¸ç­‰äºç©ºçš„                     | Herman Melville,J. R. R. Tolkien           |
| `${store.book[author='Nigel Rees'].title}` | æ“ä½œå¯¹è±¡çš„ store çš„ book ä¸­ author ç­‰äº Nigel Rees çš„ book çš„ title | Sayings of the Century                     |

#### å†…ç½®æ–¹æ³•-FuncNode

| å†™æ³•                      | ä¾‹å­                           | å€¼   |
| ------------------------- | ------------------------------ | ---- |
| `%{getNowTime()}`         | è·å–å½“å‰æ—¶é—´                   | çœ‹è¡¨ |
| `%{add(attr1:1,attr2:2)}` | è¿›è¡Œ 1+2 ï¼Œkey:val çš„å†™æ³•      | 3    |
| `%{add(1,2)}`             | è¿›è¡Œ 1+2 é»˜è®¤ key ä¸ºä¸‹æ ‡çš„å†™æ³• | 3    |

å†…ç½®å‡½æ•°æ˜¯æˆ‘ä»¬åŸºäº SPI æœºåˆ¶æä¾›çš„æ‰©å±•ç‚¹ä¹‹ä¸€ï¼Œç›®å‰æˆ‘ä»¬å®ç°äº†è¿™äº›å†…ç½®å‡½æ•°

å¦‚æœæœ‰ä¸æ»¡è¶³ä½ çš„å¯ä»¥æŒ‰ç…§ä¸€ä¸‹æ–¹å¼æ‰©å±•

1.  ç»§æ‰¿ FunctionHandler

```
package org.dromara.testhub.nsrule.core.executer.mode.base.function;

import com.alibaba.fastjson.JSONObject;
import org.dromara.testhub.nsrule.core.executer.context.Context;

public interface FunctionHandler {
    String getName();

    Object execute(Context context, JSONObject data);
}

```

2.  åœ¨ META-INF.services è·¯å¾„ä¸‹çš„ org.dromara.testhub.nsrule.core.executer.mode.base.function.FunctionHandler é…ç½®çš„ä½ æ‰©å±•æ–¹æ³•

#### ç®—æ•°è¿ç®—-ArithmeticNode

æ˜¯çš„æˆ‘ä»¬æ”¯æŒäº†æ‰‹å†™ç®—æ•°è¿ç®—çš„è¡¨è¾¾å¼

| ç¬¦å· | ä½œç”¨   |
| ---- | ------ |
| +    | åŠ      |
| \-   | å‡     |
| `*`  | ä¹˜     |
| /    | é™¤     |
| %    | å–ä½™   |
| ()   | ä¼˜å…ˆçº§ |

| å†™æ³•            | ä¾‹å­                | å€¼  |
| --------------- | ------------------- | --- |
| `1+2+3*4/5%3`   | è®¡ç®—`1+2+3*4/5%3`   | 5.4 |
| `1+(2+3)*4/5%3` | è®¡ç®—`1+(2+3)*4/5%3` | 2   |

#### æ··åˆè¡¨è¾¾å¼-MixNode

ç”¨æˆ·ç»„åˆæ‰€æœ‰ FormulaNode æœ€ç»ˆç»“æœè¿”å›å­—ç¬¦ä¸²

| å†™æ³•                                             | ä¾‹å­                                        | å€¼                                  |
| ------------------------------------------------ | ------------------------------------------- | ----------------------------------- |
| `http:${expensive}:10010/server/workerHeartbeat` | å°†æ“ä½œå¯¹è±¡çš„ expensive çš„å€¼æ›¿æ¢åè¿”å›å­—ç¬¦ä¸² | http:2:10010/server/workerHeartbeat |

## å®è·µ

![](/assets/img/news/TestHub-1.0.3-1.jpg)

```
<?xml version="1.0" encoding="UTF-8"?>

<rule code="RULE_0000000013" name="Formulaæ“ä½œæ•°ä½¿ç”¨è¯´æ˜" model="flow" project="default">
    <actions>
        <action code="getData" name="æ“ä½œæ•°æ®" type="CONST" dataType="MAP">
            <bound>
                {"store":{"book":[{"category":"reference","author":"Nigel Rees","title":"Sayings of the Century","price":8.95},{"category":"fiction","author":"Evelyn Waugh","title":"Sword of Honour","price":12.99},{"category":"fiction","author":"Herman Melville","title":"Moby Dick","isbn":"0-553-21311-3","price":8.99},{"category":"fiction","author":"J. R. R. Tolkien","title":"The Lord of the Rings","isbn":"0-395-19395-8","price":22.99}],"bicycle":{"color":"red","price":19.95}},"expensive":2}
            </bound>
        </action>
    </actions>
    <flows>
        <flow code="flow1">
            <execute code="stp1" name="è·å–åŸºç¡€æ“ä½œæ•°æ®" actionCode="getData"/>
            <execute code="stp2" name="å›ºå®šå€¼-DataNode" actionCode="check">
                <checkItem code="check1" name="å›ºå®šå€¼æ•°å­—" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="NUMBER" cover="-1.0086" threshold="-1.0086"/>
                </checkItem>
                <checkItem code="check2" name="å›ºå®šå€¼å­—ç¬¦ä¸²" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="STRING" cover="* 0/1 * * * ?" threshold="* 0/1 * * * ?"/>
                </checkItem>
                <checkItem code="check3" name="å›ºå®šå€¼åˆ—è¡¨" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="NUMBER" coverComplex="1" cover="[${stp1.expensive},1]" thresholdComplex="1" threshold="[2,1]"/>
                </checkItem>
            </execute>
            <execute code="stp3" name="å˜é‡å€¼-PathNode" actionCode="check">
                <checkItem code="check1" name="æ“ä½œå¯¹è±¡çš„ expensive çš„å€¼" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="NUMBER" cover="${stp1.expensive}" threshold="2"/>
                </checkItem>
                <checkItem code="check2" name="æ“ä½œå¯¹è±¡çš„ store çš„æ¯ä¸€ä¸ª book çš„ price å€¼" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="STRING" coverComplex="1" cover="${stp1.store.book.price}" thresholdComplex="1" threshold="[8.95,12.99,8.99,22.99]"/>
                </checkItem>
                <checkItem code="check3" name="æ“ä½œå¯¹è±¡çš„ store çš„æœ€åä¸€ä¸ª book çš„ author" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="STRING" cover="${stp1.store.book[-1].author}" threshold="J. R. R. Tolkien"/>
                </checkItem>
                <checkItem code="check4" name="æ“ä½œå¯¹è±¡çš„ store çš„ 0 åˆ° 2book çš„ author" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="STRING" coverComplex="1" cover="${stp1.store.book[0:2].author}" thresholdComplex="1" threshold="[Nigel Rees,Sword of Honour,Herman Melville]"/>
                </checkItem>
                <checkItem code="check5" name="æ“ä½œå¯¹è±¡çš„ store çš„ book ä¸­ isbn å±æ€§ä¸ç­‰äºç©ºçš„ çš„ author" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="STRING" coverComplex="1" cover="${stp1.store.book[?(isbn)].author}" thresholdComplex="1" threshold="[Herman Melville,J. R. R. Tolkien]"/>
                </checkItem>
                <checkItem code="check6" name="æ“ä½œå¯¹è±¡çš„ store çš„ book ä¸­ author ç­‰äº Nigel Rees çš„ book çš„ title" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="STRING" cover="${stp1.store.book[author='Nigel Rees'].title}" threshold="Sayings of the Century"/>
                </checkItem>
            </execute>
            <execute code="stp4" name="å†…ç½®æ–¹æ³•-FuncNode" actionCode="check">
                <checkItem code="check1" name="å‚æ•°key:valå½¢å¼" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="NUMBER" cover="%{add(attr1:1,attr2:2)}" threshold="3"/>
                </checkItem>
                <checkItem code="check2" name="å‚æ•°,å½¢å¼" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="NUMBER" cover="%{add(1,2)}" threshold="3"/>
                </checkItem>
            </execute>
            <execute code="stp5" name="ç®—æ•°è¿ç®—-ArithmeticNode" actionCode="check">
                <checkItem code="check1" name="è®¡ç®—1+2+3*4/5%3" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="NUMBER" cover="1+2+3*4/5%3" threshold="5.4"/>
                </checkItem>
                <checkItem code="check2" name="è®¡ç®—1+(2+3)*4/5%3" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="NUMBER" cover="1+(2+3)*4/5%3" threshold="2"/>
                </checkItem>
            </execute>
            <execute code="stp6" name="æ··åˆè¡¨è¾¾å¼-MixNode" actionCode="check">
                <checkItem code="check1" name="store çš„ bookä¸­ç¬¬expensive+1ä¸ª  çš„ author" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="STRING" cover="${stp1.store.book[%{add(${stp1.expensive},1)}].author}" threshold="J. R. R. Tolkien"/>
                </checkItem>
                <checkItem code="check2" name="store çš„ bookä¸­ç¬¬expensive+1ä¸ª  çš„ author" msg="">
                    <expression expressionType="relation" operationCode="eq" dataType="STRING" cover="${stp1.expensive}.1" threshold="2.1"/>
                </checkItem>
            </execute>
        </flow>
    </flows>
</rule>

```
